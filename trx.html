<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Transmedia Research Institute</title>
    <link rel="icon" type="image/x-icon" href="asset/red.ico" />
    <style>
      :root {
        --bg-red: #ff0000;
        --text-black: #000000;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: var(--bg-red);
        color: var(--text-black);
        font-family: "Arial Narrow", "Arial Condensed", Arial, Helvetica,
          sans-serif;
        font-size: 16px;
      }

      .scene {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        perspective: 1200px;
        touch-action: none;
      }

      .orbit {
        position: relative;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        transition: transform 0.08s linear;
      }

      .text-layer {
        position: absolute;
        left: 50%;
        top: 50%;
        transform-style: preserve-3d;
        text-transform: uppercase;
        color: var(--text-black);
        font-size: 30pt;
        text-align: center;
        pointer-events: auto;
      }

      .title-main {
        /* la posizione “sopra/sotto” la gestiamo via JS con baseY */
      }

      .title-link {
        text-decoration: underline;
      }

      .title-link a {
        color: inherit;
        text-decoration: underline;
      }

      ::selection {
        background: #000;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="scene" id="scene">
      <div class="orbit" id="orbit">
        <div class="text-layer title-main" id="tri">
          Transmedia Research Institute
        </div>

        <div class="text-layer title-link" id="pcl">
          <a href="#" target="_blank" rel="noreferrer"> POST-COMPUTING LAB </a>
        </div>
      </div>
    </div>

    <script>
      const orbit = document.getElementById("orbit");
      const scene = document.getElementById("scene");
      const mainEl = document.getElementById("tri");
      const linkEl = document.getElementById("pcl");

      // rotazione orbitale globale (drag)
      let rotX = 0;
      let rotY = 0;
      let isPointerDown = false;
      let startX = 0,
        startY = 0,
        startRotX = 0,
        startRotY = 0;

      function updateOrbit() {
        orbit.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
      }

      updateOrbit();

      // random 3D locale dei testi (inclusa rotazione orizzontale Y)
      function randomTransform(baseY = 0) {
        const jitterX = (Math.random() - 0.5) * 100; // ±50px orizzontale
        const jitterY = (Math.random() - 0.5) * 30 + baseY; // ±30px attorno a baseY
        const jitterZ = (Math.random() - 0.5) * 400; // profondità
        const rotX = (Math.random() - 0.5) * 100; // inclinazione verticale
        const rotY = (Math.random() - 0.5) * 120; // ROTAZIONE ORIZZONTALE (ampia)
        const rotZ = (Math.random() - 0.5) * 10; // inclinazione “in piano”

        return `
        translate3d(-50%, -50%, 0)
        translate3d(${jitterX}px, ${jitterY}px, ${jitterZ}px)
        rotateX(${rotX}deg)
        rotateY(${rotY}deg)
        rotateZ(${rotZ}deg)
      `;
      }

      function applyRandomPositions() {
        // main un po’ sopra il centro, link un po’ sotto
        if (mainEl) mainEl.style.transform = randomTransform(-100);
        if (linkEl) linkEl.style.transform = randomTransform(100);
      }

      // inizializzazione
      applyRandomPositions();

      // controllo orbitale con drag
      scene.addEventListener("pointerdown", (e) => {
        if (e.target.closest("a")) return; // non bloccare il link
        isPointerDown = true;
        scene.setPointerCapture(e.pointerId);
        startX = e.clientX;
        startY = e.clientY;
        startRotX = rotX;
        startRotY = rotY;
      });

      scene.addEventListener("pointermove", (e) => {
        if (!isPointerDown) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;

        rotY = startRotY + dx * 0.15; // orizzontale
        rotX = startRotX - dy * 0.15; // verticale
        rotX = Math.max(-80, Math.min(80, rotX));

        updateOrbit();
      });

      scene.addEventListener("pointerup", (e) => {
        if (!isPointerDown) return;
        isPointerDown = false;
        try {
          scene.releasePointerCapture(e.pointerId);
        } catch (_) {}

        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        const dist = Math.sqrt(dx * dx + dy * dy);

        // click/tap quasi fermo → randomizza posizioni
        if (!e.target.closest("a") && dist < 5) {
          applyRandomPositions();
        }
      });

      scene.addEventListener("pointercancel", (e) => {
        isPointerDown = false;
        try {
          scene.releasePointerCapture(e.pointerId);
        } catch (_) {}
      });
    </script>
  </body>
</html>
