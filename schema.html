<!DOCTYPE html>
<<<<<<< Updated upstream
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Struttura a Nodi â€“ Fluida e Ordinata</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
=======
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Visual Tree (Left to Right)</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      body {
        margin: 0;
        font-family: sans-serif;
      }

>>>>>>> Stashed changes
      svg {
        width: 100vw;
        height: 100vh;
        background: #f8f8f8;
      }
<<<<<<< Updated upstream
      .node rect {
        fill: white;
        stroke: #333;
        stroke-width: 1.5;
        rx: 4;
        ry: 4;
      }
      .node text {
        font: 12px monospace;
        pointer-events: none;
      }
      .link {
        fill: none;
        stroke: #999;
=======

      .node rect {
        fill: white;
        stroke: black;
        stroke-width: 1.5;
        rx: 6;
        ry: 6;
      }

      .node text {
        font-size: 12px;
        pointer-events: none;
      }

      .link {
        fill: none;
        stroke: black;
>>>>>>> Stashed changes
        stroke-width: 1.5px;
        marker-end: url(#arrow);
      }
    </style>
  </head>
  <body>
    <svg></svg>
<<<<<<< Updated upstream
    <script>
      // Nodi esattamente come definiti da te
      const nodes = [
        { id: "1" },
        { id: "1.1", parent: "1" },
        { id: "1.1.1", parent: "1.1" },
        { id: "1.1.2", parent: "1.1" },
        { id: "1.1.2.1", parent: "1.1.2" },
        { id: "handle" },
        { id: "handle.1", parent: "handle" },
        { id: "handle.2" },
        { id: "1.2", parent: "1" },
        { id: "1.3", parent: "1" },
        { id: "1.3.1", parent: "1.3" },
        { id: "1.3.2", parent: "1.3" },
        { id: "1.3.3", parent: "1.3" },
        { id: "1.3.1+1.3.2" },
        { id: "ideasperimentale.1", parent: "1.3.1+1.3.2" },
        { id: "handle.2+ideasperimentale.1" },
        { id: "1.3.2+1.3.3" },
        { id: "(1.3.2+1.3.3)+1.2" },
      ];

      const links = [
        { source: "1", target: "1.1" },
        { source: "1.1", target: "1.1.1" },
        { source: "1.1", target: "1.1.2" },
        { source: "1.1.2", target: "1.1.2.1" },
        { source: "1.1.2.1", target: "handle" },
        { source: "handle", target: "handle.1" },
        { source: "1", target: "1.2" },
        { source: "1", target: "1.3" },
        { source: "1.3", target: "1.3.1" },
        { source: "1.3", target: "1.3.2" },
        { source: "1.3", target: "1.3.3" },
        { source: "1.3.1", target: "1.3.1+1.3.2" },
        { source: "1.3.2", target: "1.3.1+1.3.2" },
        { source: "1.3.1+1.3.2", target: "ideasperimentale.1" },
        { source: "handle.2", target: "handle.2+ideasperimentale.1" },
        { source: "ideasperimentale.1", target: "handle.2+ideasperimentale.1" },
        { source: "1.3.2", target: "1.3.2+1.3.3" },
        { source: "1.3.3", target: "1.3.2+1.3.3" },
        { source: "1.3.2+1.3.3", target: "(1.3.2+1.3.3)+1.2" },
        { source: "1.2", target: "(1.3.2+1.3.3)+1.2" },
      ];

      const svg = d3.select("svg");

      // Frecce
=======

    <script>
      const rawData = {
        id: "1",
        label: "1\nDate: dd/mm/aa\nTitle/Keyword\nBrief\nText text text...",
        children: [
          {
            id: "1.1",
            label:
              "1.1\nDate: dd/mm/aa\nTitle/Keyword\nAction: Research\nArea: Networks\nText text text...",
            children: [
              {
                id: "1.1.1",
                label:
                  "1.1.1\nDate: dd/mm/aa\nTitle/Keyword\nAction: Research\nArea: Robotics\nText text text...",
              },
              {
                id: "1.1.2",
                label:
                  "1.1.2\nDate: dd/mm/aa\nTitle/Keyword\nAction: Research\nArea: Biology\nText text text...",
              },
            ],
          },
          {
            id: "1.2",
            label:
              "1.2\nDate: dd/mm/aa\nTitle/Keyword\nAction: Research\nArea: Networks\nText text text...",
          },
        ],
      };

      const svg = d3.select("svg");
      const width = window.innerWidth;
      const height = window.innerHeight;
      const margin = { top: 40, right: 200, bottom: 40, left: 40 };
      const g = svg
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

>>>>>>> Stashed changes
      svg
        .append("defs")
        .append("marker")
        .attr("id", "arrow")
        .attr("viewBox", "0 -5 10 10")
        .attr("refX", 10)
        .attr("refY", 0)
        .attr("markerWidth", 6)
        .attr("markerHeight", 6)
        .attr("orient", "auto")
        .append("path")
        .attr("d", "M0,-5L10,0L0,5")
<<<<<<< Updated upstream
        .attr("fill", "#999");

      // Simulazione
      const simulation = d3
        .forceSimulation(nodes)
        .force(
          "link",
          d3
            .forceLink(links)
            .id((d) => d.id)
            .distance(150)
        )
        .force("charge", d3.forceManyBody().strength(-800))
        .force(
          "x",
          d3
            .forceX()
            .strength(0.1)
            .x((d) => 50 + d.id.length * 35)
        ) // spinta orizzontale
        .force(
          "y",
          d3
            .forceY()
            .strength(0.1)
            .y(window.innerHeight / 2)
        );

      // Collegamenti
      const link = svg
        .append("g")
        .selectAll("path")
        .data(links)
        .join("path")
        .attr("class", "link");

      // Nodi
      const node = svg
        .append("g")
        .selectAll("g")
        .data(nodes)
        .join("g")
        .attr("class", "node")
        .call(
          d3
            .drag()
            .on("start", (event, d) => {
              if (!event.active) simulation.alphaTarget(0.3).restart();
              d.fx = d.x;
              d.fy = d.y;
            })
            .on("drag", (event, d) => {
              d.fx = event.x;
              d.fy = event.y;
            })
            .on("end", (event, d) => {
              if (!event.active) simulation.alphaTarget(0);
              d.fx = null;
              d.fy = null;
            })
        );

      node
        .append("rect")
        .attr("width", (d) => d.id.length * 8 + 20)
        .attr("height", 30)
        .attr("x", (d) => -((d.id.length * 8 + 20) / 2))
        .attr("y", -15);
=======
        .attr("fill", "black");

      // Convert to hierarchy
      const root = d3.hierarchy(rawData);

      // Tree layout: left to right
      const treeLayout = d3.tree().nodeSize([120, 200]);
      treeLayout(root);

      // Draw links
      g.selectAll(".link")
        .data(root.links())
        .join("path")
        .attr("class", "link")
        .attr(
          "d",
          (d) => `
    M${d.source.y},${d.source.x}
    C${(d.source.y + d.target.y) / 2},${d.source.x}
     ${(d.source.y + d.target.y) / 2},${d.target.x}
     ${d.target.y},${d.target.x}
  `
        )
        .attr("marker-end", "url(#arrow)");

      // Draw nodes
      const node = g
        .selectAll(".node")
        .data(root.descendants())
        .join("g")
        .attr("class", "node")
        .attr("transform", (d) => `translate(${d.y},${d.x})`);

      node
        .append("rect")
        .attr("x", -90)
        .attr("y", -50)
        .attr("width", 180)
        .attr("height", 100);
>>>>>>> Stashed changes

      node
        .append("text")
        .attr("text-anchor", "middle")
<<<<<<< Updated upstream
        .attr("dy", "0.35em")
        .text((d) => d.id);

      // Tick
      simulation.on("tick", () => {
        link.attr(
          "d",
          d3
            .linkHorizontal()
            .x((d) => d.x)
            .y((d) => d.y)
        );
        node.attr("transform", (d) => `translate(${d.x},${d.y})`);
      });
=======
        .selectAll("tspan")
        .data((d) => d.data.label.split("\n"))
        .join("tspan")
        .attr("x", 0)
        .attr("dy", (d, i) => `${i * 1.2}em`)
        .text((d) => d);
>>>>>>> Stashed changes
    </script>
  </body>
</html>
